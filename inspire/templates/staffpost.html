{% extends "staff.html" %}

{% block staff %}
<script>
    $(() => {
        $('#add-tags').keyup(function(event) {
            if (event.which == 32) {
                let vals = $(this).val().split(' ')
                let val = vals[vals.length - 2]
                
                if (val && val.length <= 30) {
                    let valspan = $(`<span>${val}</span>`)

                    let x = $('<span>x</span>')
                    .attr({class:'tag-x', id:`${val}-x`})
                    .click(function() {
                        let id = $(this).attr("id").replace('-x','')
                        $(`#${id}`).remove()
                    })

                    let span = $('<span></span>')
                    .attr({class: 'tag', id:`${val}`})

                    span.append(valspan)
                    span.append(x)

                    $('#tags').append(span)
                }

                $(this).val('');
            }
        })

        $('.tag-x').click(function() {
            let id = $(this).attr("id").replace('-x','')
            $(id).remove()
        })

        $('#form').submit(function() {
            let tags = ""
            $('#tags .tag').each(function(tag){
                tags += $(this).attr('id') + ' '
                $('#hidden-tags').val(tags)
            })
        })
    })
</script>

<form action="/staff/post/{{ ptype }}" method="post" id="form">
    {% csrf_token %}
    <input name="title" placeholder="Title" required>
    <br>
    <label for="category">Category: </label>
    <select name="category" id="category">
        {% if ptype == "text" %}
        <option value="quote">Quote</option>
        <option value="article">Article</option>
        <option value="movie">Movie</option>
        <option value="album">Album</option>
        {% endif %}

        {% if ptype == "video" %}
        <option value="speech">Speech</option>
        {% endif %}
    </select>
    <br>
    <textarea name="description" cols="40" rows="5" placeholder="Description"></textarea>
    <br>
    {% if ptype == "text" %}
    <textarea name="text" cols="40" rows="5" placeholder="Text" required></textarea>
    <br>
    <input name="image" placeholder="Image">
    {% endif %}
    {% if ptype == "video" %}
    <input name="src" placeholder="Video Link" required>
    <br>
    <label for="platform">Platform: </label>
    <select name="platform" id="platform">
        <option value="youtube">Youtube</option>
    </select>
    <br>
    {% endif %}
    <input name="tags" id="hidden-tags" hidden>
    <br>
    <input type="submit" value="Post">
</form>
<br>
<div id="tags"></div>
<input placeholder="Add Tags" id="add-tags">

{% endblock %}